<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A√±adir Propiedad - Portal Inmobiliario</title>

<!-- Font Awesome para iconos -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
  body { font-family: 'Segoe UI', Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
  h1,h2 { color: #333; margin:0; }
  h1 { text-align:center; margin:20px 0; font-size:2em; }
  
  .contenedor {
    display: flex; gap:20px; max-width:1000px; margin:0 auto; padding:20px;
    flex-wrap: wrap;
  }

  /* Formulario */
  .formulario {
    flex:2; background:#fff; padding:20px; border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
  }

  .formulario h2 {
    display:flex; align-items:center; margin-top:25px; font-size:1.2em;
  }

  .formulario h2::before {
    content: attr(data-num);
    display:inline-block; width:25px; height:25px; margin-right:10px;
    background:#3498DB; color:#fff; border-radius:50%; text-align:center; line-height:25px;
    font-weight:bold;
  }

  label { display:block; margin-top:10px; font-weight:bold; position:relative; }
  label i { margin-right:8px; color:#3498DB; }

  /* Tooltip */
  label .tooltip {
    display:inline-block; margin-left:5px; color:#fff; background:#3498DB; border-radius:50%;
    width:18px; height:18px; text-align:center; line-height:18px; font-size:12px; cursor:pointer;
    position:relative;
  }
  label .tooltip:hover::after {
    content: attr(data-text);
    position:absolute; top:25px; left:0; width:200px; background:#333; color:#fff; padding:5px;
    border-radius:5px; font-size:0.85em; z-index:1000; white-space:normal;
  }

  input, select, textarea, button {
    width:100%; margin-top:5px; padding:10px; border-radius:6px;
    border:1px solid #ccc; box-sizing:border-box; font-size:1em;
  }

  .checkbox-group label { font-weight:normal; margin-right:15px; }
  button {
    background:#3498DB; color:white; border:none; cursor:pointer;
    margin-top:15px; transition:0.3s; font-size:1em;
  }
  button:hover { background:#2980B9; }

  .mensaje { text-align:center; font-weight:bold; margin-top:10px; }

  /* Informaci√≥n √∫til */
  .informacion-util {
    flex:1;
    background:#fffaf0;
    border-left:5px solid #f1c40f;
    padding:15px;
    border-radius:8px;
    max-height:90vh;
    overflow-y:auto;
    font-size:0.95em;
    line-height:1.5em;
  }
  .informacion-util ul { padding-left:15px; }
  .informacion-util li { margin-bottom:12px; }
  .informacion-util li ul { margin-top:5px; margin-left:20px; list-style-type:disc; }
  .informacion-util li strong { color:#2980b9; }

  /* Fotos */
  #previsualizacion img {
    width:120px; height:120px; object-fit:cover; border-radius:6px;
    box-shadow:0 2px 5px rgba(0,0,0,0.2); transition:0.3s;
  }
  #previsualizacion img:hover { transform:scale(1.05); }

  #barraProgreso {
    width:100%; height:20px; background:#eee; border-radius:10px; margin-top:10px; display:none;
  }
  #progreso { width:0%; height:100%; background:#3498DB; border-radius:10px; }

  /* Bot√≥n Comprobar direcci√≥n */
  #btn-comprobar {
    margin-top:10px; background:#27ae60; color:white; border:none;
    padding:8px; border-radius:6px; cursor:pointer; width:auto;
  }
  #btn-comprobar:hover { background:#1e8449; }

  /* Responsive */
  @media(max-width:800px) {
    .contenedor { flex-direction:column; }
    .informacion-util { max-height:none; margin-top:20px; }
  }
</style>
</head>
<body>

<h1>Portal Inmobiliario üè°</h1>

<div class="contenedor">

  <!-- Formulario -->
  <div class="formulario">
    <h2 data-num="1">Datos b√°sicos</h2>
    <label for="tipo"><i class="fa-solid fa-building"></i> Tipo de inmueble
      <span class="tooltip" data-text="Selecciona el tipo de propiedad que quieres publicar.">?</span>
    </label>
    <select id="tipo">
      <option value="">Selecciona</option>
      <option value="piso">Piso</option>
      <option value="casa">Casa</option>
      <option value="atico">√Åtico</option>
      <option value="chalet">Chalet</option>
      <option value="garaje">Garaje</option>
      <option value="local">Local</option>
      <option value="parcela">Parcela</option>
    </select>

    <label for="operacion"><i class="fa-solid fa-exchange-alt"></i> Operaci√≥n
      <span class="tooltip" data-text="Elige si deseas poner la propiedad en venta o alquiler.">?</span>
    </label>
    <select id="operacion">
      <option value="">Selecciona</option>
      <option value="venta">Venta</option>
      <option value="alquiler">Alquiler</option>
    </select>

    <label for="titulo"><i class="fa-solid fa-pen"></i> T√≠tulo del anuncio
      <span class="tooltip" data-text="Escribe un t√≠tulo llamativo y descriptivo para tu anuncio.">?</span>
    </label>
    <input type="text" id="titulo" placeholder="Ej: Piso luminoso en el centro">

    <label for="descripcion"><i class="fa-solid fa-align-left"></i> Descripci√≥n breve
      <span class="tooltip" data-text="Describe la propiedad destacando sus puntos fuertes.">?</span>
    </label>
    <textarea id="descripcion" rows="4" placeholder="Descripci√≥n de la propiedad"></textarea>

    <h2 data-num="2">Detalles</h2>
    <label for="habitaciones"><i class="fa-solid fa-bed"></i> N√∫mero de habitaciones
      <span class="tooltip" data-text="Indica cu√°ntas habitaciones tiene la propiedad.">?</span>
    </label>
    <input type="number" id="habitaciones" min="0">

    <label for="banos"><i class="fa-solid fa-bath"></i> N√∫mero de ba√±os
      <span class="tooltip" data-text="Indica el n√∫mero de ba√±os disponibles.">?</span>
    </label>
    <input type="number" id="banos" min="0">

    <label for="superficie"><i class="fa-solid fa-ruler-combined"></i> Superficie (m¬≤)
      <span class="tooltip" data-text="Escribe la superficie √∫til en metros cuadrados.">?</span>
    </label>
    <input type="number" id="superficie" min="0">

    <label>Caracter√≠sticas</label>
    <div class="checkbox-group">
      <label><input type="checkbox" value="terraza"> Terraza</label>
      <label><input type="checkbox" value="balcon"> Balc√≥n</label>
      <label><input type="checkbox" value="garaje"> Garaje</label>
      <label><input type="checkbox" value="piscina"> Piscina</label>
      <label><input type="checkbox" value="amueblado"> Amueblado</label>
    </div>

    <label for="precio"><i class="fa-solid fa-euro-sign"></i> Precio (‚Ç¨)
      <span class="tooltip" data-text="Introduce el precio total en euros, sin comas ni puntos.">?</span>
    </label>
    <input type="number" id="precio" min="0">

    <h2 data-num="3">Ubicaci√≥n</h2>
    <label for="localidad"><i class="fa-solid fa-location-dot"></i> Localidad
      <span class="tooltip" data-text="Ejemplo: Madrid, Barcelona, Sevilla.">?</span>
    </label>
    <input type="text" id="localidad" placeholder="Ej: Madrid">

    <label for="calle"><i class="fa-solid fa-road"></i> Nombre de la v√≠a
      <span class="tooltip" data-text="Nombre de la calle o avenida donde se encuentra la propiedad.">?</span>
    </label>
    <input type="text" id="calle" placeholder="Ej: Calle Mayor">

    <label for="numero"><i class="fa-solid fa-hashtag"></i> N√∫mero de v√≠a
      <span class="tooltip" data-text="N√∫mero de la vivienda en la calle.">?</span>
    </label>
    <input type="text" id="numero" placeholder="Ej: 15">

    <label><input type="checkbox" id="ocultarCalle"> Ocultar calle y n√∫mero (opcional)
      <span class="tooltip" data-text="Marca esta opci√≥n si deseas que no se muestre la calle exacta en el anuncio.">?</span>
    </label>

    <button type="button" id="btn-comprobar"><i class="fa-solid fa-map"></i> Comprobar direcci√≥n</button>

    <h2 data-num="4">Fotos</h2>
    <label for="imagenes"><i class="fa-solid fa-camera"></i> Subir fotos
      <span class="tooltip" data-text="Puedes subir hasta 10 fotos por anuncio. Formatos: jpg, png.">?</span>
    </label>
    <input type="file" id="imagenes" multiple accept="image/*">
    <p id="contadorFotos">0 fotos seleccionadas</p>
    <div id="previsualizacion" style="display:flex; gap:10px; overflow-x:auto;"></div>
    <div id="barraProgreso"><div id="progreso"></div></div>
    <p>Si no tienes todas las fotos ahora, puedes a√±adirlas m√°s tarde.</p>

    <button type="button" id="btn-enviar"><i class="fa-solid fa-paper-plane"></i> A√±adir Propiedad</button>
    <p id="mensaje" class="mensaje"></p>
  </div>

  <!-- Informaci√≥n √∫til -->
  <div class="informacion-util">
    <h2>Informaci√≥n √∫til</h2>
    <ul>
      <li>üì∑ <strong>Ten las fotos a mano:</strong> Si no las tienes, podr√°s a√±adirlas m√°s tarde. Sin fotos no tendr√°s resultados.</li>
      <li>üéÅ <strong>Primeros dos anuncios gratis:</strong> Puedes publicar gratis pisos, chalets, garajes, parcelas, locales, etc., hasta que lo vendas o lo alquiles.</li>
      <li>üè† <strong>Habitaciones gratis en piso compartido:</strong> Puedes publicar hasta 5 habitaciones gratis; no cuentan en el n√∫mero de anuncios gratuitos.</li>
      <li>‚ö†Ô∏è <strong>Casos de pago:</strong>
        <ul>
          <li>Anunciantes con m√°s de dos inmuebles</li>
          <li>Anuncios duplicados</li>
          <li>Inmuebles en venta de m√°s de 1.000.000 ‚Ç¨</li>
          <li>Inmuebles en alquiler de m√°s de 2.500 ‚Ç¨/mes</li>
        </ul>
      </li>
      <li>üè¢ <strong>¬øQuieres vender tu casa r√°pidamente?</strong> Encuentra la agencia inmobiliaria m√°s adecuada.</li>
      <li>üëî <strong>¬øEres profesional inmobiliario?</strong> Conoce nuestras ventajas para profesionales.</li>
    </ul>
  </div>

</div>

<script>
// Variables
const inputFotos = document.getElementById('imagenes');
const contenedorPrev = document.getElementById('previsualizacion');
const contadorFotos = document.getElementById('contadorFotos');
const barra = document.getElementById('barraProgreso');
const progreso = document.getElementById('progreso');
let archivosSeleccionados = [];

const btnEnviar = document.getElementById('btn-enviar');
const mensaje = document.getElementById('mensaje');

// Campos obligatorios
const camposObligatorios = [
  'tipo','operacion','titulo','precio'
];

// Previsualizaci√≥n fotos
inputFotos.addEventListener('change', () => {
  archivosSeleccionados = Array.from(inputFotos.files);
  actualizarPrevisualizacion();
});

function actualizarPrevisualizacion() {
  contenedorPrev.innerHTML = '';
  archivosSeleccionados.forEach((file,index)=>{
    const reader=new FileReader();
    reader.onload=(e)=>{
      const wrapper=document.createElement('div');
      wrapper.style.position='relative';
      const img=document.createElement('img');
      img.src=e.target.result;
      wrapper.appendChild(img);
      const btnEliminar=document.createElement('button');
      btnEliminar.textContent='X';
      btnEliminar.style.position='absolute';
      btnEliminar.style.top='2px';
      btnEliminar.style.right='2px';
      btnEliminar.style.background='rgba(255,0,0,0.8)';
      btnEliminar.style.color='white';
      btnEliminar.style.border='none';
      btnEliminar.style.borderRadius='50%';
      btnEliminar.style.width='20px';
      btnEliminar.style.height='20px';
      btnEliminar.style.cursor='pointer';
      btnEliminar.addEventListener('click',()=>{
        archivosSeleccionados.splice(index,1);
        actualizarPrevisualizacion();
      });
      wrapper.appendChild(btnEliminar);
      contenedorPrev.appendChild(wrapper);
    };
    reader.readAsDataURL(file);
  });
  contadorFotos.textContent=`${archivosSeleccionados.length} foto(s) seleccionada(s)`;
}

// Comprobar direcci√≥n
document.getElementById('btn-comprobar').addEventListener('click', () => {
  const localidad = document.getElementById('localidad').value.trim();
  const calle = document.getElementById('calle').value.trim();
  const numero = document.getElementById('numero').value.trim();

  if (!localidad || !calle || !numero) {
    alert('Por favor completa localidad, calle y n√∫mero antes de comprobar.');
    return;
  }

  const direccion = encodeURIComponent(`${calle} ${numero}, ${localidad}`);
  window.open(`https://www.google.com/maps/search/?api=1&query=${direccion}`, '_blank');
});

// Validaciones en tiempo real
camposObligatorios.forEach(id => {
  const campo = document.getElementById(id);
  campo.addEventListener('input', validarFormulario);
});

function validarFormulario() {
  let valido = true;

  camposObligatorios.forEach(id => {
    const campo = document.getElementById(id);
    if(!campo.value.trim() || (campo.type==='number' && Number(campo.value)<=0)){
      valido = false;
    }
  });

  btnEnviar.disabled = !valido;

  // Mensaje al usuario
  mensaje.textContent = valido ? '' : 'Por favor completa todos los campos obligatorios correctamente.';
}

// Inicializar validaci√≥n
validarFormulario();

// Enviar propiedad
btnEnviar.addEventListener('click',()=>{
  if(btnEnviar.disabled) return;

  const tipo=document.getElementById('tipo').value;
  const operacion=document.getElementById('operacion').value;
  const titulo=document.getElementById('titulo').value;
  const precio=document.getElementById('precio').value;

  const formData=new FormData();
  archivosSeleccionados.forEach(file=>formData.append('imagenes',file));
  formData.append('tipo',tipo);
  formData.append('operacion',operacion);
  formData.append('titulo',titulo);
  formData.append('descripcion',document.getElementById('descripcion').value);
  formData.append('precio',precio);
  formData.append('habitaciones',document.getElementById('habitaciones').value);
  formData.append('banos',document.getElementById('banos').value);
  formData.append('superficie',document.getElementById('superficie').value);
  formData.append('localidad',document.getElementById('localidad').value);
  formData.append('calle',document.getElementById('calle').value);
  formData.append('numero',document.getElementById('numero').value);
  formData.append('ocultarCalle',document.getElementById('ocultarCalle').checked);

  const xhr=new XMLHttpRequest();
  xhr.open('POST','https://miportal-inmobiliario-server.onrender.com/propiedades');

  xhr.upload.addEventListener('loadstart',()=>{
    barra.style.display='block';
    progreso.style.width='0%';
  });

  xhr.upload.addEventListener('progress',(e)=>{
    if(e.lengthComputable){
      const percent=(e.loaded/e.total)*100;
      progreso.style.width=percent+'%';
    }
  });

  xhr.onload=()=>{
    barra.style.display='none';
    if(xhr.status===200){
      mensaje.textContent='‚úÖ Propiedad a√±adida con √©xito!';
      document.querySelectorAll('.formulario input, .formulario textarea, .formulario select').forEach(el=>el.value='');
      archivosSeleccionados=[];
      actualizarPrevisualizacion();
      validarFormulario();
    }else{
      mensaje.textContent='‚ùå Error al subir las fotos.';
    }
  };

  xhr.send(formData);
});
</script>


</body>
</html>







