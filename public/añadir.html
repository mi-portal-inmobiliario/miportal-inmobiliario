<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A√±adir Propiedad - Portal Inmobiliario</title>
<link rel="stylesheet" href="styles.css">
<style>
  body { background:#FFF9E5; font-family: Arial, sans-serif; padding:20px; }
  h1 { text-align:center; color:#7CC242; margin-top:0; }
  .formulario { max-width:600px; margin:20px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
  .formulario input, .formulario select, .formulario button { width:100%; padding:10px; margin-bottom:10px; border-radius:5px; border:1px solid #ccc; box-sizing:border-box; }
  .formulario button { background:#A6CF3E; color:white; border:none; cursor:pointer; }
  .formulario button:hover { background:#7CC242; }
  #mensaje { text-align:center; font-weight:bold; margin-top:10px; }
  #previsualizacion img { width:100px; height:100px; object-fit:cover; margin-right:5px; margin-bottom:5px; border-radius:5px; }
</style>
</head>
<body>

<h1>A√±adir Propiedad üè°</h1>

<form id="formA√±adir" class="formulario" enctype="multipart/form-data">
  <label>T√≠tulo</label>
  <input type="text" name="titulo" required>

  <label>Descripci√≥n</label>
  <input type="text" name="descripcion">

  <label>Precio (‚Ç¨)</label>
  <input type="number" name="precio" required>

  <label>Direcci√≥n</label>
  <input type="text" name="direccion" required>

  <label>Imagen</label>
  <input type="file" name="imagen" accept="image/*">

  <div id="previsualizacion"></div>

  <button type="submit">A√±adir Propiedad</button>
</form>

<p id="mensaje"></p>

<script>
  // Previsualizaci√≥n de imagen
  const inputImagen = document.querySelector('input[name="imagen"]');
  const contenedorPrev = document.getElementById('previsualizacion');
  inputImagen.addEventListener('change', () => {
    contenedorPrev.innerHTML = '';
    const file = inputImagen.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = e => {
        const img = document.createElement('img');
        img.src = e.target.result;
        contenedorPrev.appendChild(img);
      };
      reader.readAsDataURL(file);
    }
  });

  // Enviar formulario usando fetch y FormData
  const form = document.getElementById('formA√±adir');
  const mensaje = document.getElementById('mensaje');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    mensaje.textContent = '‚è≥ Subiendo...';

    const formData = new FormData(form);

    try {
      const res = await fetch('/propiedades', {
        method: 'POST',
        body: formData
      });
      const data = await res.json();

      if(res.ok){
        mensaje.textContent = '‚úÖ Propiedad a√±adida con √©xito!';
        form.reset();
        contenedorPrev.innerHTML = '';
      } else {
        mensaje.textContent = '‚ùå Error: ' + (data.error || 'No se pudo a√±adir');
      }
    } catch(err){
      console.error(err);
      mensaje.textContent = '‚ùå Error al conectar con el servidor.';
    }
  });
</script>

</body>
</html>
