<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A√±adir Propiedad - Portal Inmobiliario</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
    h1, h2 { color: #333; }
    h2 { margin-top: 20px; }

    .contenedor {
      display: flex;
      gap: 20px;
      max-width: 1000px;
      margin: 0 auto;
    }

    .formulario {
      flex: 2;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .formulario label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    .formulario input, .formulario select, .formulario textarea, .formulario button {
      width: 100%;
      margin-top: 5px;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    .formulario button {
      background-color: #3498DB;
      color: white;
      border: none;
      cursor: pointer;
      padding: 12px;
      font-size: 1em;
      margin-top: 15px;
      transition: background 0.3s;
    }

    .formulario button:hover {
      background-color: #2980B9;
    }

    .mensaje {
      text-align: center;
      font-weight: bold;
      margin-top: 10px;
    }

    .checkbox-group label {
      font-weight: normal;
      margin-right: 15px;
    }

    .informacion-util {
      flex: 1;
      background: #fffbe6;
      border-left: 5px solid #f1c40f;
      padding: 15px;
      border-radius: 8px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .informacion-util ul {
      padding-left: 20px;
    }

    .informacion-util li {
      margin-bottom: 10px;
    }

    #previsualizacion img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

  </style>
</head>
<body>

  <h1>Portal Inmobiliario üè°</h1>

  <div class="contenedor">
    <!-- Formulario -->
    <div class="formulario">
      <h2>1. Datos b√°sicos</h2>

      <label for="tipo">Tipo de inmueble</label>
      <select id="tipo">
        <option value="">Selecciona</option>
        <option value="piso">Piso</option>
        <option value="casa">Casa</option>
        <option value="atico">√Åtico</option>
        <option value="chalet">Chalet</option>
        <option value="garaje">Garaje</option>
        <option value="local">Local</option>
        <option value="parcela">Parcela</option>
      </select>

      <label for="operacion">Operaci√≥n</label>
      <select id="operacion">
        <option value="">Selecciona</option>
        <option value="venta">Venta</option>
        <option value="alquiler">Alquiler</option>
      </select>

      <label for="titulo">T√≠tulo del anuncio</label>
      <input type="text" id="titulo" placeholder="Ej: Piso luminoso en el centro">

      <label for="descripcion">Descripci√≥n breve</label>
      <textarea id="descripcion" rows="4" placeholder="Descripci√≥n de la propiedad"></textarea>

      <h2>2. Detalles</h2>

      <label for="habitaciones">N√∫mero de habitaciones</label>
      <input type="number" id="habitaciones" min="0">

      <label for="banos">N√∫mero de ba√±os</label>
      <input type="number" id="banos" min="0">

      <label for="superficie">Superficie (m¬≤)</label>
      <input type="number" id="superficie" min="0">

      <label>Caracter√≠sticas</label>
      <div class="checkbox-group">
        <label><input type="checkbox" value="terraza"> Terraza</label>
        <label><input type="checkbox" value="balcon"> Balc√≥n</label>
        <label><input type="checkbox" value="garaje"> Garaje</label>
        <label><input type="checkbox" value="piscina"> Piscina</label>
        <label><input type="checkbox" value="amueblado"> Amueblado</label>
      </div>

      <label for="precio">Precio (‚Ç¨)</label>
      <input type="number" id="precio" min="0">

      <h2>3. Ubicaci√≥n</h2>

      <label for="localidad">Localidad</label>
      <input type="text" id="localidad" placeholder="Ej: Madrid">

      <label for="calle">Nombre de la v√≠a</label>
      <input type="text" id="calle" placeholder="Ej: Calle Mayor">

      <label for="numero">N√∫mero de v√≠a</label>
      <input type="text" id="numero" placeholder="Ej: 15">

      <label><input type="checkbox" id="ocultarCalle"> Ocultar calle y n√∫mero (opcional)</label>

      <h2>4. Fotos</h2>
      <label for="imagenes">Sube tus fotos</label>
      <input type="file" id="imagenes" multiple accept="image/*">
      <p id="contadorFotos">0 fotos seleccionadas</p>
      <div id="previsualizacion" style="display:flex; gap:10px; overflow-x:auto;"></div>
      <p>Si no tienes todas las fotos ahora, puedes a√±adirlas m√°s tarde.</p>

      <button type="button" id="btn-enviar">A√±adir Propiedad</button>
      <p id="mensaje" class="mensaje"></p>
    </div>

    <!-- Informaci√≥n √∫til -->
    <div class="informacion-util">
      <h2>Informaci√≥n √∫til</h2>
      <ul>
        <li>Ten las fotos a mano. Si no las tienes, podr√°s a√±adirlas m√°s tarde. Sin fotos no tendr√°s resultados.</li>
        <li>Te regalamos tus primeros dos anuncios para que pruebes nuestro servicio. Puedes publicar gratis pisos, chalets, garajes, parcelas, locales, etc. hasta que lo vendas o lo alquiles.</li>
        <li>Adem√°s, puedes publicar hasta 5 habitaciones gratis en piso compartido, no suman en el n√∫mero de anuncios que te regalamos.</li>
        <li>Para poder mantener nuestra calidad de servicio necesitamos cobrar en estos casos:
          <ul>
            <li>Anunciantes con m√°s de dos inmuebles</li>
            <li>Anuncios de inmuebles duplicados</li>
            <li>Inmuebles en venta de m√°s de 1.000.000 ‚Ç¨</li>
            <li>Inmuebles en alquiler de m√°s de 2.500 ‚Ç¨/mes</li>
          </ul>
        </li>
        <li>¬øQuieres vender tu casa r√°pidamente? Encuentra la agencia inmobiliaria m√°s adecuada</li>
        <li>¬øEres profesional inmobiliario? Conoce nuestras ventajas para profesionales</li>
      </ul>
    </div>
  </div>

  <script>
    const inputFotos = document.getElementById('imagenes');
    const contenedorPrev = document.getElementById('previsualizacion');
    const contadorFotos = document.getElementById('contadorFotos');
    let archivosSeleccionados = [];

    inputFotos.addEventListener('change', () => {
      archivosSeleccionados = Array.from(inputFotos.files);
      actualizarPrevisualizacion();
    });

    function actualizarPrevisualizacion() {
      contenedorPrev.innerHTML = '';
      archivosSeleccionados.forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const wrapper = document.createElement('div');
          wrapper.style.position = 'relative';
          const img = document.createElement('img');
          img.src = e.target.result;
          wrapper.appendChild(img);

          const btnEliminar = document.createElement('button');
          btnEliminar.textContent = 'X';
          btnEliminar.style.position = 'absolute';
          btnEliminar.style.top = '2px';
          btnEliminar.style.right = '2px';
          btnEliminar.style.background = 'rgba(255,0,0,0.8)';
          btnEliminar.style.color = 'white';
          btnEliminar.style.border = 'none';
          btnEliminar.style.borderRadius = '50%';
          btnEliminar.style.width = '20px';
          btnEliminar.style.height = '20px';
          btnEliminar.style.cursor = 'pointer';
          btnEliminar.addEventListener('click', () => {
            archivosSeleccionados.splice(index, 1);
            actualizarPrevisualizacion();
          });
          wrapper.appendChild(btnEliminar);
          contenedorPrev.appendChild(wrapper);
        };
        reader.readAsDataURL(file);
      });
      contadorFotos.textContent = `${archivosSeleccionados.length} foto(s) seleccionada(s)`;
    }

    document.getElementById('btn-enviar').addEventListener('click', async () => {
      const tipo = document.getElementById('tipo').value;
      const operacion = document.getElementById('operacion').value;
      const titulo = document.getElementById('titulo').value;
      const precio = document.getElementById('precio').value;
      const localidad = document.getElementById('localidad').value;
      const calle = document.getElementById('calle').value;

      if(!tipo || !operacion || !titulo || !precio || !localidad || !calle) {
        alert('Por favor, completa todos los campos obligatorios.');
        return;
      }
      if(Number(precio) <= 0) {
        alert('El precio debe ser mayor que 0.');
        return;
      }

      const caracteristicas = Array.from(document.querySelectorAll('.checkbox-group input:checked')).map(cb => cb.value);
      const formData = new FormData();
      archivosSeleccionados.forEach(file => formData.append('imagenes', file));
      formData.append('tipo', tipo);
      formData.append('operacion', operacion);
      formData.append('titulo', titulo);
      formData.append('descripcion', document.getElementById('descripcion').value);
      formData.append('habitaciones', document.getElementById('habitaciones').value);
      formData.append('banos', document.getElementById('banos').value);
      formData.append('superficie', document.getElementById('superficie').value);
      formData.append('caracteristicas', JSON.stringify(caracteristicas));
      formData.append('precio', precio);
      formData.append('localidad', localidad);
      formData.append('calle', calle);
      formData.append('numero', document.getElementById('numero').value);
      formData.append('ocultarCalle', document.getElementById('ocultarCalle').checked);

      try {
        const res = await fetch('https://miportal-inmobiliario-server.onrender.com/propiedades', {
          method: 'POST',
          body: formData
        });

        const data = await res.json();
        const mensaje = document.getElementById('mensaje');
        if(res.ok) {
          mensaje.textContent = '‚úÖ Propiedad a√±adida con √©xito!';
          document.querySelectorAll('.formulario input, .formulario textarea').forEach(el => el.value = '');
          document.querySelectorAll('.checkbox-group input').forEach(el => el.checked = false);
          archivosSeleccionados = [];
          actualizarPrevisualizacion();
        } else {
          mensaje.textContent = '‚ùå Error: ' + (data.error || 'No se pudo a√±adir');
        }
      } catch (err) {
        document.getElementById('mensaje').textContent = '‚ùå Error al conectar con el servidor.';
      }
    });
  </script>

</body>
</html>






