<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A√±adir Propiedad - Portal Inmobiliario</title>
<link rel="stylesheet" href="styles.css">
<style>
body { background:#FFF9E5; font-family: Arial, sans-serif; padding:20px; }
h1 { text-align:center; color:#7CC242; }
.formulario-multistep { background:white; padding:20px; border-radius:10px; max-width:600px; margin:20px auto; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
.formulario-multistep input, .formulario-multistep select, .formulario-multistep button { width:100%; margin-bottom:10px; padding:8px; border-radius:5px; border:1px solid #ccc; box-sizing:border-box; }
.formulario-multistep button { background:#A6CF3E; color:white; border:none; cursor:pointer; font-size:1em; transition: background 0.3s; }
.formulario-multistep button:hover { background:#7CC242; }
.mensaje { text-align:center; font-weight:bold; margin-top:10px; }
.informacion-util { background:white; padding:15px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-top:20px; max-width:600px; margin-left:auto; margin-right:auto;}
.informacion-util h3 { color:#7CC242; margin-bottom:10px; }
.informacion-util ul { padding-left:20px; line-height:1.6; }
.informacion-util a { color:#A6CF3E; text-decoration:none; }
.informacion-util a:hover { text-decoration:underline; }

/* Vista previa im√°genes */
.preview-container {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 10px;
}
.preview-item {
  position: relative;
  width: 100px;
  height: 100px;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 5px rgba(0,0,0,0.15);
  cursor: pointer;
  transition: transform 0.2s;
}
.preview-item:hover { transform: scale(1.05); }
.preview-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.preview-item button {
  position: absolute;
  top: 3px;
  right: 3px;
  background: rgba(0,0,0,0.6);
  color: white;
  border: none;
  border-radius: 50%;
  width: 22px;
  height: 22px;
  font-size: 14px;
  cursor: pointer;
}
.preview-item button:hover { background: red; }

/* Modal imagen grande */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.8);
  justify-content: center;
  align-items: center;
}
.modal img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.5);
}
.modal button {
  position: absolute;
  top: 20px; background: rgba(255,255,255,0.7);
  border: none; font-size: 24px; border-radius: 50%; cursor: pointer;
}
.modal button:hover { background: white; }
#cerrarModal { right: 30px; }
#anteriorModal { left: 30px; font-size: 40px; background: transparent; color: white; }
#siguienteModal { right: 30px; font-size: 40px; background: transparent; color: white; }
#anteriorModal:hover, #siguienteModal:hover { color: #A6CF3E; }
</style>
</head>
<body>

<h1>A√±adir Propiedad üè°</h1>

<form id="formAgregarPropiedad" class="formulario-multistep" enctype="multipart/form-data">

  <!-- Paso 1 -->
  <div class="paso" id="paso1">
    <h2>Datos b√°sicos</h2>
    <input type="text" name="titulo" placeholder="T√≠tulo" required>
    <input type="text" name="direccion" placeholder="Direcci√≥n completa" required>
    <button type="button" id="siguiente1">Siguiente ‚Üí</button>
  </div>

  <!-- Paso 2 -->
  <div class="paso" id="paso2" style="display:none;">
    <h2>Detalles</h2>
    <input type="number" name="precio" placeholder="Precio (‚Ç¨)" required>
    <input type="text" name="descripcion" placeholder="Descripci√≥n">
    <button type="button" id="anterior2">‚Üê Anterior</button>
    <button type="button" id="siguiente2">Siguiente ‚Üí</button>
  </div>

  <!-- Paso 3 -->
  <div class="paso" id="paso3" style="display:none;">
    <h2>Fotos</h2>
    <input type="file" id="imagenes" name="imagenes" accept="image/*" multiple required>
    <small>Puedes seleccionar varias im√°genes. Haz clic para verlas en grande o eliminar.</small>
    <div class="preview-container" id="preview"></div>
    <br>
    <button type="button" id="anterior3">‚Üê Anterior</button>
    <button type="submit">A√±adir Propiedad</button>
  </div>

</form>

<p id="mensaje" class="mensaje"></p>

<!-- Modal con navegaci√≥n -->
<div class="modal" id="modalImagen">
  <button id="anteriorModal">‚ü®</button>
  <img src="" alt="Vista ampliada">
  <button id="siguienteModal">‚ü©</button>
  <button id="cerrarModal">√ó</button>
</div>

<div class="informacion-util">
<h3>Informaci√≥n √∫til</h3>
<ul>
<li>üì∑ Puedes subir varias fotos a la vez para destacar tu anuncio.</li>
<li>üéÅ Los dos primeros anuncios son gratuitos.</li>
<li>‚ö†Ô∏è Se aplican cargos para m√°s de dos inmuebles o anuncios duplicados.</li>
<li>üè¢ <a href="vender.html">M√°s informaci√≥n sobre vender tu propiedad ‚Üí</a></li>
<li>üëî <a href="profesionales.html">Ventajas para profesionales ‚Üí</a></li>
</ul>
</div>

<script>
// Navegaci√≥n pasos
let pasoActual = 1;
function mostrarPaso(paso) {
  document.querySelectorAll(".paso").forEach((el, i) => el.style.display = (i+1) === paso ? "block" : "none");
}
document.getElementById("siguiente1").onclick = ()=>{ pasoActual=2; mostrarPaso(pasoActual); };
document.getElementById("siguiente2").onclick = ()=>{ pasoActual=3; mostrarPaso(pasoActual); };
document.getElementById("anterior2").onclick = ()=>{ pasoActual=1; mostrarPaso(pasoActual); };
document.getElementById("anterior3").onclick = ()=>{ pasoActual=2; mostrarPaso(pasoActual); };

// Vista previa
const inputImagenes = document.getElementById("imagenes");
const preview = document.getElementById("preview");
const modal = document.getElementById("modalImagen");
const modalImg = modal.querySelector("img");
const cerrarModal = document.getElementById("cerrarModal");
const anteriorModal = document.getElementById("anteriorModal");
const siguienteModal = document.getElementById("siguienteModal");

let archivosSeleccionados = [];
let indiceActual = 0;

inputImagenes.addEventListener("change", (e) => {
  archivosSeleccionados = Array.from(e.target.files);
  mostrarVistaPrevia();
});

function mostrarVistaPrevia() {
  preview.innerHTML = "";
  archivosSeleccionados.forEach((archivo, index) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      const div = document.createElement("div");
      div.classList.add("preview-item");
      div.innerHTML = `
        <img src="${e.target.result}" alt="imagen" data-index="${index}">
        <button type="button" data-index="${index}">√ó</button>
      `;
      preview.appendChild(div);
    };
    reader.readAsDataURL(archivo);
  });
}

// Eliminar o ver imagen
preview.addEventListener("click", (e) => {
  const index = parseInt(e.target.getAttribute("data-index"));
  if (e.target.tagName === "BUTTON") {
    archivosSeleccionados.splice(index, 1);
    actualizarInput();
    mostrarVistaPrevia();
  } else if (e.target.tagName === "IMG") {
    indiceActual = index;
    abrirModal(index);
  }
});

function abrirModal(index) {
  modalImg.src = URL.createObjectURL(archivosSeleccionados[index]);
  modal.style.display = "flex";
}

cerrarModal.onclick = () => modal.style.display = "none";
modal.onclick = (e) => { if (e.target === modal) modal.style.display = "none"; };

anteriorModal.onclick = () => {
  indiceActual = (indiceActual - 1 + archivosSeleccionados.length) % archivosSeleccionados.length;
  abrirModal(indiceActual);
};
siguienteModal.onclick = () => {
  indiceActual = (indiceActual + 1) % archivosSeleccionados.length;
  abrirModal(indiceActual);
};

function actualizarInput() {
  const dt = new DataTransfer();
  archivosSeleccionados.forEach(f => dt.items.add(f));
  inputImagenes.files = dt.files;
}

// Env√≠o al backend
const form = document.getElementById("formAgregarPropiedad");
const mensaje = document.getElementById("mensaje");

form.addEventListener("submit", async (e)=>{
  e.preventDefault();
  const formData = new FormData(form);
  archivosSeleccionados.forEach(f => formData.append("imagenes", f));

  try {
    const res = await fetch("https://miportal-inmobiliario-server.onrender.com/propiedades", {
      method: "POST",
      body: formData
    });

    const data = await res.json();
    if(res.ok){
      mensaje.textContent = "‚úÖ Propiedad a√±adida con √©xito!";
      form.reset();
      preview.innerHTML = "";
      archivosSeleccionados = [];
      pasoActual=1; mostrarPaso(pasoActual);
    } else {
      mensaje.textContent = "‚ùå Error: "+(data.error||"No se pudo a√±adir");
    }
  } catch(err){
    console.error(err);
    mensaje.textContent = "‚ùå Error al conectar con el servidor.";
  }
});
</script>

</body>
</html>











